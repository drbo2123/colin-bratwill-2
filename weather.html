<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather & Forecast - Colin Bratwill</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background: linear-gradient(to bottom, #0b0d13, #1b1e2a); color: #e0e6f0; font-family: Arial,sans-serif; text-align: center; }
.weather-box, .forecast-box { background: rgba(21,24,35,0.9); padding: 1.5rem; border-radius: 10px; margin: 1rem auto; max-width: 600px; box-shadow: 0 0 15px rgba(0,0,0,0.7); }
.weather-icon { width: 50px; height: 50px; vertical-align: middle; }
</style>
</head>
<body>
<h1>Weather & Forecast</h1>

<div class="weather-box" id="weather">Loading current weather...</div>

<div class="forecast-box">
<h2>Next 24 Hours Temperature</h2>
<canvas id="tempChart"></canvas>
</div>

<script>
const apiKey = "YOUR_OPENWEATHERMAP_API_KEY"; // Replace with your key

// Example: London if geolocation fails
let lat = 51.5074, lon = -0.1278;

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(pos => { lat = pos.coords.latitude; lon = pos.coords.longitude; fetchWeather(); }, fetchWeather);
} else { fetchWeather(); }

async function fetchWeather() {
  try {
    // Current weather
    const resCur = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`);
    const dataCur = await resCur.json();
    const icon = `http://openweathermap.org/img/wn/${dataCur.weather[0].icon}@2x.png`;
    document.getElementById('weather').innerHTML = `
      <h2>${dataCur.name}, ${dataCur.sys.country}</h2>
      <p><img src="${icon}" class="weather-icon"> ${dataCur.weather[0].description}</p>
      <p>Temperature: ${dataCur.main.temp}°C</p>
      <p>Humidity: ${dataCur.main.humidity}%</p>
      <p>Wind Speed: ${dataCur.wind.speed} m/s</p>
    `;

    // Forecast (next 8 x 3-hour = 24 hours)
    const resF = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`);
    const dataF = await resF.json();
    const next8 = dataF.list.slice(0,8);
    const labels = next8.map(f => new Date(f.dt * 1000).getHours() + ":00");
    const temps = next8.map(f => f.main.temp);

    const ctx = document.getElementById('tempChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Temperature °C',
          data: temps,
          borderColor: '#77c8ff',
          backgroundColor: 'rgba(119,200,255,0.2)',
          fill: true,
          tension: 0.3
        }]
      },
      options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: false } } }
    });

  } catch(e) {
    document.getElementById('weather').innerText = "Error fetching weather.";
    console.error(e);
  }
}
</script>
</body>
</html>
